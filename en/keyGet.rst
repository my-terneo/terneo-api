**Getting TOTP key**
====================

To securely control device with TOTP protocol authentication, you need to know the key, 
which is a sequence of 16 bytes. It's generated by the cloud at the first connection
and every time you bind to the account.
 
You can get it through the server API only in 2 steps:
	* get the authorization token for the required account
	* get a list of devices with parameters linked to this account

`Getting an authorization token`
````````````````````````````````

    **POST** https://my.hmarex.com/api/login/
	
.. code-block:: json
	
		{
			"email":"user@email.com",
			"password":"myPassword"
		}

**Parameters:**
	- **email** - email of account
	- **password** - account password

**Answer:**

.. code-block:: json

		{
			"access_token":"9573e6a8e24b025fafbaf81dc2eccbc09b94d187",
			"user_name":"myterneo",
			"is_timezone_chosen":true
		}

``access_token`` - required authorization token

**Example:**

http

.. code-block:: python
	
	POST /api/login/ HTTP/1.1
	Host: my.hmarex.com
	Accept-Language: en	
	Content-Type: application/json

	{"email":"myterneo@gmail.com","password":"myterneo2018"}
	
curl

.. code-block:: python

	curl -i -X POST https://my.hmarex.com/api/login/ -H 'Accept-Language: en' -H 'Content-Type: application/json' --data-raw '{"email": "myterneo@gmail.com", "password": "myterneo2018"}'


wget

.. code-block:: python

	wget -S -O- https://my.hmarex.com/api/login/ --header='Accept-Language: en' --header='Content-Type: application/json' --post-data='{"email": "myterneo@gmail.com", "password": "myterneo2018"}'


httpie

.. code-block:: python

	echo '{
	"email": "myterneo@gmail.com",
	"password": "myterneo2018"
	}' | http POST https://my.hmarex.com/api/login/ Accept-Language:en Content-Type:application/json

python-requests

.. code-block:: python

	requests.post('https://my.hmarex.com/api/login/', headers={'Accept-Language': 'en', 'Content-Type': 'application/json'}, json={'email': 'myterneo@gmail.com', 'password': 'myterneo2018'})



`Getting list of device`
````````````````````````
    
    **GET** https://my.hmarex.com/api/device/ 
	
	--header "Authorization: Token ``access_token``

		**Parameters**
			- ``access_token`` - authorization token in header
        		
* Answer:

	.. code-block:: json

		{
			"count": 4,
			"next": null,
			"previous": null,
			"results": [
				{
					"id": 18801,
					"sn": "1100150010434B58363539XXXXXXXX",
					"name": "Room1",
					"":""
					"totp_key": "BW4ERXAJXXXXXXXX"
				}
			]

		}

Field ``totp_key`` in parameters of every devices has required key for TOTP token generation.

* Example:
	
http

.. code-block:: python
	
	POST /api/login/ HTTP/1.1
	Host: my.hmarex.com
	Accept-Language: en
	Content-Type: application/json

	{"email":"myterneo@gmail.com","password":"myterneo2018"}
	
curl

.. code-block:: python

	curl -i -X POST https://my.hmarex.com/api/login/ -H 'Accept-Language: en' -H 'Content-Type: application/json' --data-raw '{"email": "myterneo@gmail.com", "password": "myterneo2018"}'

wget

.. code-block:: python

	wget -S -O- https://my.hmarex.com/api/login/ --header='Accept-Language: en' --header='Content-Type: application/json' --post-data='{"email": "myterneo@gmail.com", "password": "myterneo2018"}'

httpie

.. code-block:: python

	echo '{
	"email": "myterneo@gmail.com",
	"password": "myterneo2018"
	}' | http POST https://my.hmarex.com/api/login/ Accept-Language:en Content-Type:application/json

python-requests

.. code-block:: python

	requests.post('https://my.hmarex.com/api/login/', headers={'Accept-Language': 'en', 'Content-Type': 'application/json'}, json={'email': 'myterneo@gmail.com', 'password': 'myterneo2018'})

